<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BrewHaven — Luxury Café Management</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;900&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------- Palette (bright luxury) ---------- */
    :root{
      --cream:#FFF8F0;
      --gold:#D4A373;
      --brown:#4E342E;
      --white:#FFFFFF;
      --beige:#F3E5AB;
      --muted: rgba(78,52,46,0.7);
      --glass: rgba(255,255,255,0.55);
      --card-glass: rgba(255,255,255,0.65);
      --radius:16px;
      --trans: 260ms cubic-bezier(.2,.9,.3,1);
      --shadow: 0 8px 30px rgba(78,52,46,0.12);
      color-scheme: light;
    }

    /* ---------- Base ---------- */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #fffdfb 0%, #fff8f0 100%);
      color:var(--brown);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-y:scroll;
    }

    a{color:inherit;text-decoration:none}
    button{font-family:inherit}

    /* ---------- Layout ---------- */
    header{
      position:sticky;
      top:0;
      z-index:1200;
      padding:14px 28px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.3));
      border-bottom:1px solid rgba(78,52,46,0.06);
      backdrop-filter: blur(6px) saturate(120%);
    }

    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,var(--gold),#c8864b);
      display:grid;place-items:center;color:var(--white);font-weight:900;font-family:"Playfair Display";
      font-size:20px;box-shadow:var(--shadow);
    }
    .brand .title{line-height:1}
    .brand .title h1{margin:0;font-family:"Playfair Display";font-size:20px;letter-spacing:0.6px}
    .brand .title p{margin:0;font-size:12px;color:var(--muted)}

    nav{display:flex;gap:10px;align-items:center}
    nav a{padding:10px 12px;border-radius:10px;font-weight:600;color:var(--muted);transition:all var(--trans)}
    nav a:hover{transform:translateY(-3px);color:var(--brown)}
    nav a.active{background:linear-gradient(90deg, rgba(212,163,115,0.08), rgba(243,208,122,0.03)); color:var(--brown)}

    main{max-width:1200px;margin:26px auto;padding:0 18px;}

    .section{margin-bottom:28px;opacity:0;transform:translateY(8px);transition:opacity 420ms ease, transform 420ms ease}
    .section.visible{opacity:1;transform:none}

    /* ---------- Hero ---------- */
    .hero{
      display:grid;
      grid-template-columns:1fr 420px;
      gap:20px;
      align-items:center;
    }
    .hero-card{
      padding:28px;border-radius:20px;background:linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.7)); box-shadow:var(--shadow);
      display:flex;flex-direction:column;gap:12px;
    }
    .hero h2{font-family:"Playfair Display";font-size:40px;margin:0;color:var(--brown)}
    .hero p{margin:0;color:var(--muted);font-weight:500}

    .hero-cta{display:flex;gap:12px;align-items:center}
    .btn{
      padding:10px 14px;border-radius:12px;border:none;cursor:pointer;
      background:linear-gradient(90deg,var(--gold),#c88b54); color:var(--white); font-weight:700; box-shadow:0 8px 22px rgba(200,130,70,0.14);
      transition:transform var(--trans), box-shadow var(--trans);
    }
    .btn:hover{transform:translateY(-4px); box-shadow:0 14px 38px rgba(200,130,70,0.18)}
    .btn.ghost{background:transparent;border:1px solid rgba(78,52,46,0.06); color:var(--brown)}

    .hero-side{
      padding:18px;border-radius:18px;background:linear-gradient(180deg, rgba(243,229,203,0.55), rgba(255,255,255,0.6));
      box-shadow:var(--shadow);
    }

    /* ---------- Controls (search, filters) ---------- */
    .controls{display:flex;gap:12px;align-items:center;margin:18px 0;flex-wrap:wrap}
    .search{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;background:rgba(255,255,255,0.8);border:1px solid rgba(78,52,46,0.04);flex:1;
      box-shadow:0 6px 18px rgba(0,0,0,0.04)
    }
    .search input{border:none;background:transparent;outline:none;font-weight:600;width:100%}
    .chips{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.8);font-weight:700;border:1px solid rgba(78,52,46,0.04);cursor:pointer}
    .chip.active{background:var(--gold);color:#2a170f;box-shadow:0 8px 20px rgba(212,161,90,0.12)}

    /* ---------- Menu Grid ---------- */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .menu-card{
      border-radius:16px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.6));
      box-shadow:0 8px 30px rgba(78,52,46,0.06);display:flex;flex-direction:column;gap:10px;min-height:220px;
    }
    .menu-thumb{height:140px;border-radius:10px;background:#f5efe6;overflow:hidden;display:grid;place-items:center}
    .menu-thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:900;color:var(--brown)}
    .meta .btn{padding:8px 10px;font-size:14px;border-radius:10px}

    /* ---------- Sidebar (cart) ---------- */
    .layout{display:flex;gap:18px}
    .content{flex:1}
    aside{width:340px}
    .cart{
      padding:14px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(243,235,217,0.85));box-shadow:var(--shadow)
    }
    .cart h3{margin:0 0 8px}
    .cart-list{display:flex;flex-direction:column;gap:10px;max-height:300px;overflow:auto;padding-right:6px}
    .cart-item{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .qty{display:flex;align-items:center;gap:6px}
    .small{font-size:13px;color:var(--muted)}

    /* ---------- Admin panel ---------- */
    .admin-panel{padding:14px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));box-shadow:var(--shadow)}
    .form-grid{display:grid;grid-template-columns:1fr 140px;gap:10px}
    input,textarea,select{padding:8px;border-radius:10px;border:1px solid rgba(78,52,46,0.06);outline:none;width:100%}
    label{font-weight:700;color:var(--brown);font-size:13px}

    /* ---------- Dashboard ---------- */
    .dash{
      display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:12px;
    }
    .dash .stat{
      padding:16px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));box-shadow:var(--shadow)
    }
    .stat h4{margin:0;font-family:"Playfair Display";font-size:18px}
    .stat p{margin:8px 0 0;font-weight:800;font-size:22px;color:var(--brown)}

    /* ---------- Modal + Toast ---------- */
    .modal{position:fixed;inset:0;background:rgba(10,10,10,0.3);display:grid;place-items:center;z-index:999}
    .modal .panel{width:min(900px,96%);max-height:86vh;overflow:auto;padding:18px;border-radius:14px;background:var(--white)}
    .toast-wrap{position:fixed;right:22px;bottom:22px;display:flex;flex-direction:column;gap:8px;z-index:9999}
    .toast{background:linear-gradient(90deg,var(--gold),#c88b54);color:#fff;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow)}

    /* ---------- Floating Coffee Icon ---------- */
    .floating-coffee{
      position:fixed;right:20px;bottom:120px;width:64px;height:64px;border-radius:999px;background:linear-gradient(135deg,var(--gold),#c1864a);
      display:grid;place-items:center;color:#fff;font-weight:900;font-family:"Playfair Display";box-shadow:0 14px 36px rgba(200,130,70,0.18);cursor:pointer;z-index:900;
      animation: floaty 4.5s ease-in-out infinite;
    }
    @keyframes floaty{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}

    /* ---------- Responsive ---------- */
    @media (max-width:1000px){ .hero{grid-template-columns:1fr} .grid{grid-template-columns:repeat(2,1fr)} aside{width:100%} .layout{flex-direction:column-reverse} .dash{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){ .grid{grid-template-columns:1fr} .dash{grid-template-columns:1fr} nav{display:none} .brand .title h1{font-size:18px} .logo{width:48px;height:48px} header{padding:12px} }

  </style>
</head>
<body>

  <header>
    <div class="brand">
      <div class="logo">BH</div>
      <div class="title">
        <h1>BrewHaven</h1>
        <p>Brewed to Perfection — Luxury Café Management</p>
      </div>
    </div>

    <nav id="main-nav">
      <a href="#home" class="nav-link active">Home</a>
      <a href="#menu" class="nav-link">Menu</a>
      <a href="#orders" class="nav-link">Orders</a>
      <a href="#dashboard" class="nav-link">Dashboard</a>
      <a href="#admin" class="nav-link">Admin</a>
    </nav>

  </header>

  <main>
    <!-- HERO -->
    <section id="home" class="section hero visible">
      <div class="hero-card">
        <h2>Welcome to BrewHaven</h2>
        <p>Celebrate the art of coffee with boutique flavors, warm hospitality, and a luxurious atmosphere.</p>

        <div style="display:flex;gap:12px;align-items:center;margin-top:14px">
          <button class="btn" id="to-menu">Explore Menu</button>
          <button class="btn ghost" id="to-admin">Open Admin</button>
        </div>

        <div style="margin-top:18px" class="small">Quick tip — Press <strong>/</strong> to focus search. Press <strong>H</strong> to open Orders history.</div>
      </div>

      <div class="hero-side">
        <div style="font-weight:800">Today's Special</div>
        <div style="margin-top:8px" class="small">Caramel Cloud Latte — limited batch</div>
        <div style="margin-top:12px">
          <img src="https://source.unsplash.com/520x360/?caramel-latte,coffee" alt="special" style="width:100%;height:210px;object-fit:cover;border-radius:10px;display:block">
        </div>
      </div>
    </section>

    <!-- CONTROLS -->
    <div class="section visible" style="margin-top:12px">
      <div class="controls">
        <div class="search" id="search-bar">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"></circle></svg>
          <input id="search-input" placeholder="Search menu by name or category..." />
        </div>

        <div class="chips" id="chips"></div>

        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn ghost" id="view-receipts">Receipts</button>
        </div>
      </div>
    </div>

    <!-- MENU + CART -->
    <section id="menu" class="section visible">
      <div class="layout">
        <div class="content">
          <h3 style="margin-top:0">Menu</h3>
          <div id="menu-grid" class="grid"></div>

          <!-- Admin quick add from menu view -->
          <div style="margin-top:16px" id="quick-add-area"></div>
        </div>

        <aside>
          <div class="cart">
            <h3>Your Cart</h3>
            <div id="cart-list" class="cart-list"></div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
              <div class="small">Total:</div>
              <div style="font-weight:900;color:var(--brown)" id="cart-total">₹0</div>
            </div>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button class="btn" id="checkout">Checkout</button>
              <button class="btn ghost" id="clear-cart">Clear</button>
            </div>

          </div>
        </aside>
      </div>
    </section>

    <!-- Orders -->
    <section id="orders" class="section">
      <h3>Active Orders</h3>
      <div id="active-orders" style="margin-top:12px"></div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="section">
      <h3>Dashboard</h3>
      <div class="dash">
        <div class="stat">
          <h4>Today's Sales</h4>
          <p id="today-sales">₹0</p>
        </div>
        <div class="stat">
          <h4>Total Orders</h4>
          <p id="total-orders">0</p>
        </div>
        <div class="stat">
          <h4>Customers</h4>
          <p id="total-customers">0</p>
        </div>
      </div>

      <div style="margin-top:14px;background:linear-gradient(180deg,#fffefb,#fff7ef);padding:12px;border-radius:12px;box-shadow:var(--shadow)">
        <h4 style="margin:0 0 12px">Sales (last 7 days)</h4>
        <canvas id="sales-chart" width="900" height="260" style="width:100%;max-width:100%"></canvas>
      </div>
    </section>

    <!-- Admin -->
    <section id="admin" class="section">
      <h3>Admin Panel</h3>
      <div class="admin-panel" style="margin-top:12px">
        <form id="item-form" class="form-grid" onsubmit="return false;">
          <div>
            <label>Name</label>
            <input id="i-name" placeholder="Cappuccino" required />
            <label style="margin-top:8px">Description</label>
            <textarea id="i-desc" rows="2" placeholder="A short description"></textarea>
          </div>
          <div>
            <label>Price (₹)</label>
            <input id="i-price" type="number" min="0" placeholder="150" required />
            <label style="margin-top:8px">Category</label>
            <input id="i-cat" placeholder="Coffee" />
            <label style="margin-top:8px">Image URL (optional)</label>
            <input id="i-img" placeholder="https://..." />
            <div style="display:flex;gap:8px;margin-top:12px">
              <button class="btn" id="save-item">Save</button>
              <button class="btn ghost" id="reset-item">Reset</button>
            </div>
          </div>
        </form>
        <div style="margin-top:12px" class="small">Menu and orders are stored locally (localStorage). Use this demo to prototype features before connecting to a backend.</div>
      </div>
    </section>

  </main>

  <!-- Floating coffee -->
  <div class="floating-coffee" id="coffee-float" title="BrewHaven">
    ☕
  </div>

  <!-- Toasts & Modals -->
  <div id="toast-wrap" class="toast-wrap" aria-live="polite"></div>

  <div id="modal-root"></div>

  <script>
    /* =========================
       BrewHaven V2 — single file
       Features: menu mgmt, orders, dashboard, charts, images, toasts, confetti
       ========================= */

    // ---------- Storage keys ----------
    const KEY_MENU = 'brewhaven_v3_menu';
    const KEY_CART = 'brewhaven_v3_cart';
    const KEY_RECEIPTS = 'brewhaven_v3_receipts';
    const KEY_ACTIVE = 'brewhaven_v3_activeOrders';

    // ---------- Defaults ----------
    const DEFAULT_MENU = [
      {id:'m1', name:'Espresso', price:80, category:'Coffee', desc:'Pure and bold espresso shot.'},
      {id:'m2', name:'Cappuccino', price:140, category:'Coffee', desc:'Silky foam layered over espresso.'},
      {id:'m3', name:'Caramel Cloud Latte', price:160, category:'Coffee', desc:'Caramel drizzle with airy milk.'},
      {id:'m4', name:'Blueberry Muffin', price:110, category:'Pastry', desc:'Buttery muffin with fresh blueberries.'},
      {id:'m5', name:'Chocolate Brownie', price:120, category:'Pastry', desc:'Fudgy and rich.'},
    ];

    // ---------- Helpers ----------
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
    const uid = (p='id')=> p + Math.random().toString(36).slice(2,9);

    function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
    function load(key, fallback=null){ try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; } catch(e){ return fallback; } }

    // ensure defaults
    if(!load(KEY_MENU)) save(KEY_MENU, DEFAULT_MENU);
    if(!load(KEY_CART)) save(KEY_CART, []);
    if(!load(KEY_RECEIPTS)) save(KEY_RECEIPTS, []);
    if(!load(KEY_ACTIVE)) save(KEY_ACTIVE, []);

    // ---------- Image helper: Unsplash source for AI-like images ----------
    function unsplashFor(item){
      if(item.img) return item.img;
      const q = encodeURIComponent(item.name + ' ' + (item.category||'cafe') + ' coffee food');
      // unique sig to vary results
      return `https://source.unsplash.com/800x600/?${q}&sig=${item.id}`;
    }

    // ---------- Toasts ----------
    const toastWrap = $('#toast-wrap');
    function toast(msg, opts = {}) {
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      toastWrap.appendChild(t);
      const ms = opts.duration || 3000;
      setTimeout(()=> { t.style.opacity = 0; t.style.transform = 'translateY(8px)'; }, ms - 300);
      setTimeout(()=> t.remove(), ms);
    }

    // ---------- Render Menu ----------
    const menuGrid = $('#menu-grid');
    function renderMenu(){
      const menu = load(KEY_MENU, DEFAULT_MENU);
      menuGrid.innerHTML = '';
      menu.forEach(item=>{
        const card = document.createElement('div'); card.className = 'menu-card';
        card.dataset.id = item.id;

        // thumb
        const thumb = document.createElement('div'); thumb.className='menu-thumb';
        const img = document.createElement('img');
        img.alt = item.name;
        img.loading = 'lazy';
        img.src = unsplashFor(item);
        thumb.appendChild(img);

        // content
        const title = document.createElement('div');
        title.innerHTML = `<div style="font-weight:800">${escapeHtml(item.name)}</div><div class="small">${escapeHtml(item.desc||'')}</div>`;

        const meta = document.createElement('div'); meta.className='meta';
        const price = document.createElement('div'); price.className='price'; price.textContent = `₹${Number(item.price||0).toFixed(0)}`;
        const btns = document.createElement('div');

        const addBtn = document.createElement('button'); addBtn.className='btn'; addBtn.textContent='Add';
        addBtn.addEventListener('click', ()=> { addToCart(item.id); toast(`${item.name} added to cart`); });

        const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='Edit';
        editBtn.addEventListener('click', ()=> openEdit(item.id));

        btns.appendChild(addBtn); btns.appendChild(editBtn);
        meta.appendChild(price); meta.appendChild(btns);

        card.appendChild(thumb); card.appendChild(title); card.appendChild(meta);
        menuGrid.appendChild(card);
      });

      // fade-in effect
      document.querySelectorAll('.menu-card').forEach((c,i)=> setTimeout(()=>{ c.style.opacity=1; c.style.transform='none' }, 40*i));
      populateChips();
      renderCart();
      updateDashboard();
    }

    // ---------- Escape HTML ----------
    function escapeHtml(str=''){ return String(str || '').replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }

    // ---------- Cart ----------
    function loadCart(){ return load(KEY_CART, []); }
    function saveCart(c){ save(KEY_CART, c); renderCart(); updateDashboard(); }

    function addToCart(menuId){
      const menu = load(KEY_MENU, DEFAULT_MENU);
      const item = menu.find(m=>m.id===menuId);
      if(!item) return;
      const cart = loadCart();
      const e = cart.find(x=>x.id===menuId);
      if(e) e.qty++;
      else cart.push({id:menuId, name:item.name, price:Number(item.price), qty:1});
      saveCart(cart);
    }

    function changeQty(id, qty){
      const cart = loadCart();
      const idx = cart.findIndex(x=>x.id===id);
      if(idx === -1) return;
      if(qty <= 0) cart.splice(idx,1);
      else cart[idx].qty = qty;
      saveCart(cart);
    }

    function removeFromCart(id){
      const cart = loadCart();
      const idx = cart.findIndex(x=>x.id===id);
      if(idx>-1){ cart.splice(idx,1); saveCart(cart); }
    }

    function renderCart(){
      const cartList = $('#cart-list');
      const cart = loadCart();
      cartList.innerHTML = '';
      let total = 0;
      cart.forEach(it=>{
        const row = document.createElement('div'); row.className = 'cart-item';
        row.innerHTML = `<div style="flex:1"><div style="font-weight:700">${escapeHtml(it.name)}</div><div class="small">₹${it.price} · ${it.qty} pcs</div></div>`;
        const right = document.createElement('div'); right.style.display='flex'; right.style.alignItems='center'; right.style.gap='8px';

        const q = document.createElement('div'); q.className='qty';
        const minus = document.createElement('button'); minus.textContent='−'; minus.className='btn ghost'; minus.style.padding='6px 8px';
        minus.addEventListener('click', ()=> changeQty(it.id, it.qty-1));
        const plus = document.createElement('button'); plus.textContent='+'; plus.className='btn ghost'; plus.style.padding='6px 8px';
        plus.addEventListener('click', ()=> changeQty(it.id, it.qty+1));
        const rem = document.createElement('button'); rem.textContent='Remove'; rem.className='btn ghost'; rem.style.padding='6px 8px';
        rem.addEventListener('click', ()=> removeFromCart(it.id));
        const qval = document.createElement('div'); qval.textContent = it.qty; qval.style.minWidth='22px'; qval.style.textAlign='center'; qval.style.fontWeight='700';

        q.appendChild(minus); q.appendChild(qval); q.appendChild(plus);
        right.appendChild(q); right.appendChild(rem);
        row.appendChild(right);
        cartList.appendChild(row);

        total += it.qty * it.price;
      });
      $('#cart-total').textContent = `₹${total.toFixed(0)}`;
    }

    // ---------- Checkout ----------
    $('#checkout').addEventListener('click', ()=>{
      const cart = loadCart();
      if(!cart.length){ toast('Cart is empty'); return; }
      const total = cart.reduce((s,i)=>s+i.qty*i.price,0);
      // create receipt
      const receipts = load(KEY_RECEIPTS, []);
      const receipt = { id: uid('r'), date: new Date().toISOString(), total, items: cart.slice() };
      receipts.push(receipt); save(KEY_RECEIPTS, receipts);
      // clear cart
      saveCart([]);
      toast(`Order placed — ₹${total.toFixed(0)}`);
      burstConfetti();
      // also add to active orders (simulate)
      const active = load(KEY_ACTIVE, []);
      active.push({ id: uid('o'), time: new Date().toISOString(), items: receipt.items, total });
      save(KEY_ACTIVE, active);
      renderActiveOrders();
      updateDashboard();
    });

    $('#clear-cart').addEventListener('click', ()=>{ if(confirm('Clear cart?')){ saveCart([]); } });

    // ---------- Active orders ----------
    function renderActiveOrders(){
      const container = $('#active-orders');
      const active = load(KEY_ACTIVE, []);
      container.innerHTML = '';
      if(active.length===0){ container.innerHTML = '<div class="small">No active orders.</div>'; return; }
      active.forEach(o=>{
        const d = new Date(o.time);
        const card = document.createElement('div'); card.style.padding='12px'; card.style.borderRadius='12px'; card.style.background='linear-gradient(180deg,#fffefb,#fff7ef)'; card.style.marginBottom='10px'; card.style.boxShadow='var(--shadow)';
        const header = document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between';
        header.innerHTML = `<div style="font-weight:800">Order • ${d.toLocaleTimeString()}</div><div class="small">₹${Number(o.total).toFixed(0)}</div>`;
        const list = document.createElement('div'); list.className='small'; list.style.marginTop='8px';
        o.items.forEach(it=> list.innerHTML += `<div>${it.qty}× ${escapeHtml(it.name)} — ₹${it.price}</div>`);
        const done = document.createElement('button'); done.textContent='Mark Done'; done.className='btn ghost'; done.style.marginTop='8px';
        done.addEventListener('click', ()=>{
          const arr = load(KEY_ACTIVE, []);
          const idx = arr.findIndex(x=>x.id===o.id);
          if(idx>-1){ arr.splice(idx,1); save(KEY_ACTIVE, arr); renderActiveOrders(); toast('Order completed'); updateDashboard(); }
        });
        card.appendChild(header); card.appendChild(list); card.appendChild(done);
        container.appendChild(card);
      });
    }

    // ---------- Dashboard ----------
    function updateDashboard(){
      const receipts = load(KEY_RECEIPTS, []);
      const today = new Date().toISOString().slice(0,10);
      const todaySales = receipts.filter(r=> r.date.slice(0,10) === today).reduce((s,r)=>s+Number(r.total),0);
      $('#today-sales').textContent = `₹${todaySales.toFixed(0)}`;
      $('#total-orders').textContent = `${receipts.length}`;
      // customers = unique receipts count (demo)
      $('#total-customers').textContent = `${receipts.length}`;

      // chart data: last 7 days
      const labels = []; const values = [];
      for(let i=6;i>=0;i--){
        const d = new Date(); d.setDate(d.getDate() - i);
        const key = d.toISOString().slice(0,10);
        labels.push(key);
        const sum = receipts.filter(r=> r.date.slice(0,10) === key).reduce((s,r)=>s+Number(r.total),0);
        values.push(sum);
      }
      renderSalesChart(labels, values);
    }

    // simple canvas bar chart
    function renderSalesChart(labels, values){
      const canvas = $('#sales-chart');
      const ctx = canvas.getContext('2d');
      const W = canvas.width; const H = canvas.height;
      ctx.clearRect(0,0,W,H);
      const padding = 36;
      const chartW = W - padding*2;
      const chartH = H - padding*2;
      const max = Math.max(...values, 10);
      const barW = chartW / values.length * 0.6;
      values.forEach((v,i)=>{
        const x = padding + (i*(chartW/values.length)) + (chartW/values.length - barW)/2;
        const h = (v/max) * (chartH-20);
        const y = H - padding - h;
        // gradient
        const grad = ctx.createLinearGradient(x,y,x,y+h);
        grad.addColorStop(0, 'rgba(212,163,115,0.95)');
        grad.addColorStop(1, 'rgba(200,130,70,0.6)');
        ctx.fillStyle = grad;
        roundRect(ctx, x, y, barW, h, 6, true, false);
        // label
        ctx.fillStyle = '#6b4a3e';
        ctx.font = '12px Poppins';
        ctx.fillText(`₹${v.toFixed(0)}`, x, y-6);
        // date label (short)
        const lbl = new Date(labels[i]).toLocaleDateString(undefined, {month:'short',day:'numeric'});
        ctx.fillText(lbl, x, H - padding + 14);
      });
    }

    function roundRect(ctx, x, y, w, h, r=6, fill=true, stroke=false){
      ctx.beginPath(); ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath();
      if(fill) ctx.fill(); if(stroke) ctx.stroke();
    }

    // ---------- Admin: Save / Edit / Remove ----------
    $('#save-item').addEventListener('click', ()=>{
      const name = $('#i-name').value.trim();
      const price = Number($('#i-price').value || 0);
      const desc = $('#i-desc').value.trim();
      const cat = $('#i-cat').value.trim() || 'Uncategorized';
      const img = $('#i-img').value.trim();
      if(!name || !price){ toast('Name and price required'); return; }
      const menu = load(KEY_MENU, DEFAULT_MENU);
      // if editing, we'll have a data-edit-id on form
      const editId = $('#item-form').dataset.editId;
      if(editId){
        const idx = menu.findIndex(m=>m.id===editId);
        if(idx>-1) menu[idx] = {...menu[idx], name, price, desc, category:cat, img};
        delete $('#item-form').dataset.editId;
        toast('Item updated');
      } else {
        const id = uid('m');
        menu.push({ id, name, price, desc, category:cat, img });
        toast('Item added');
      }
      save(KEY_MENU, menu);
      $('#item-form').reset();
      renderMenu();
    });

    $('#reset-item').addEventListener('click', ()=>{ $('#item-form').reset(); delete $('#item-form').dataset.editId; toast('Form reset'); });

    function openEdit(id){
      const menu = load(KEY_MENU, DEFAULT_MENU);
      const it = menu.find(m=>m.id===id);
      if(!it) return;
      $('#i-name').value = it.name; $('#i-price').value = it.price; $('#i-desc').value = it.desc || ''; $('#i-cat').value = it.category || ''; $('#i-img').value = it.img || '';
      $('#item-form').dataset.editId = id;
      window.location.hash = '#admin';
      toast('Editing item');
    }

    // remove item (accessible via context menu or admin list)
    function removeItem(id){
      if(!confirm('Remove this menu item?')) return;
      const menu = load(KEY_MENU, DEFAULT_MENU);
      const idx = menu.findIndex(m=>m.id===id);
      if(idx>-1){ menu.splice(idx,1); save(KEY_MENU, menu); renderMenu(); toast('Item removed'); }
    }

    // ---------- Search + Chips ----------
    function populateChips(){
      const chips = $('#chips');
      const menu = load(KEY_MENU, DEFAULT_MENU);
      const cats = ['All', ...new Set(menu.map(m=> m.category || 'Uncategorized'))];
      chips.innerHTML = '';
      cats.forEach((c,i)=>{
        const chip = document.createElement('div'); chip.className='chip' + (i===0?' active':''); chip.textContent = c;
        chip.addEventListener('click', ()=>{
          $$('.chip').forEach(x=>x.classList.remove('active')); chip.classList.add('active');
          applyFilter($('#search-input').value.trim(), c === 'All' ? '' : c);
        });
        chips.appendChild(chip);
      });
    }

    function applyFilter(query='', category=''){
      const q = query.trim().toLowerCase();
      const cards = $$('.menu-card');
      cards.forEach(card=>{
        const id = card.dataset.id;
        const menu = load(KEY_MENU, DEFAULT_MENU);
        const item = menu.find(m=>m.id===id);
        const text = (item.name + ' ' + (item.desc||'') + ' ' + (item.category||'')).toLowerCase();
        const matches = (!q || text.includes(q)) && (!category || (item.category === category));
        card.style.display = matches ? '' : 'none';
      });
    }

    $('#search-input').addEventListener('input', (e)=> applyFilter(e.target.value, ($$('.chip.active')[0] && $$('.chip.active')[0].textContent !== 'All') ? $$('.chip.active')[0].textContent : '') );
    window.addEventListener('keydown', e=>{ if(e.key==='/' && document.activeElement.tagName!=='INPUT'){ e.preventDefault(); $('#search-input').focus(); } if(e.key.toLowerCase()==='h'){ openReceiptsModal(); } });

    // ---------- Receipts Viewer ----------
    function openReceiptsModal(){
      const receipts = load(KEY_RECEIPTS, []);
      const root = document.createElement('div'); root.className='modal';
      const panel = document.createElement('div'); panel.className='panel';
      panel.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><h3>Receipts</h3><button id="close-modal" class="btn ghost">Close</button></div><div id="receipts-list" style="margin-top:12px"></div>`;
      root.appendChild(panel);
      document.body.appendChild(root);
      $('#close-modal', panel).addEventListener('click', ()=> root.remove());
      const list = $('#receipts-list', panel);
      if(!receipts.length) list.innerHTML = '<div class="small">No receipts yet.</div>';
      receipts.slice().reverse().forEach(r=>{
        const d = new Date(r.date);
        const item = document.createElement('div'); item.style.padding='10px'; item.style.borderRadius='10px'; item.style.marginBottom='8px'; item.style.background='linear-gradient(180deg,#fffefb,#fff7ef)';
        item.innerHTML = `<div style="display:flex;justify-content:space-between"><strong>₹${Number(r.total).toFixed(0)}</strong><div class="small">${d.toLocaleString()}</div></div>`;
        const ul = document.createElement('div'); ul.className='small'; ul.style.marginTop='8px';
        r.items.forEach(it => ul.innerHTML += `<div>${it.qty}× ${escapeHtml(it.name)} — ₹${it.price}</div>`);
        item.appendChild(ul);
        list.appendChild(item);
      });
    }
    $('#view-receipts').addEventListener('click', openReceiptsModal);

    // ---------- Floating coffee click ----------
    $('#coffee-float').addEventListener('click', ()=> {
      toast('Welcome to BrewHaven ✨');
      // simple pulse
      const el = $('#coffee-float'); el.animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}], {duration:600, easing:'ease-out'});
    });

    // ---------- Confetti ----------
    function burstConfetti(){
      const canvas = document.createElement('canvas');
      canvas.style.position='fixed'; canvas.style.left=0; canvas.style.top=0; canvas.style.width='100%'; canvas.style.height='100%'; canvas.style.zIndex=9999;
      document.body.appendChild(canvas);
      canvas.width = innerWidth; canvas.height = innerHeight;
      const ctx = canvas.getContext('2d');
      const total = 80;
      const pieces = Array.from({length:total}).map(()=>({
        x: Math.random()*canvas.width,
        y: -Math.random()*canvas.height,
        vx: (Math.random()-0.5)*2,
        vy: Math.random()*4+2,
        size: Math.random()*8+4,
        color: `hsl(${Math.random()*40 + 20}deg 70% 50%)`
      }));
      let t=0;
      function frame(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.vy += 0.05;
          ctx.fillStyle = p.color;
          ctx.fillRect(p.x, p.y, p.size, p.size*0.6);
        });
        t++;
        if(t<150) requestAnimationFrame(frame); else canvas.remove();
      }
      frame();
    }

    // small wrapper used earlier
    function burstConfettiQuick(){ burstConfetti(); }

    // ---------- Utils + init ----------
    function init(){
      renderMenu();
      renderActiveOrders();
      updateDashboard();
      // link nav
      $$('.nav-link').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault(); const href = a.getAttribute('href');
          document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active')); a.classList.add('active');
          document.querySelector(href).scrollIntoView({behavior:'smooth', block:'start'});
        });
      });
      // quick nav buttons
      $('#to-menu').addEventListener('click', ()=> { document.querySelector('#menu').scrollIntoView({behavior:'smooth'}); });
      $('#to-admin').addEventListener('click', ()=> { document.querySelector('#admin').scrollIntoView({behavior:'smooth'}); });
      // focus search hotkey
      $('#search-input').addEventListener('keydown', (e)=> { if(e.key==='Enter') applyFilter($('#search-input').value.trim(), ($$('.chip.active')[0] && $$('.chip.active')[0].textContent !== 'All') ? $$('.chip.active')[0].textContent : ''); });

      // quick-add area (to create demo items quickly)
      const qa = $('#quick-add-area');
      qa.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><input id="qa-name" placeholder="Quick item name" style="padding:8px;border-radius:10px;border:1px solid rgba(78,52,46,0.06)"><input id="qa-price" placeholder="Price" style="width:110px;padding:8px;border-radius:10px;border:1px solid rgba(78,52,46,0.06)"><button class="btn" id="qa-add">Add Quick</button></div>`;
      $('#qa-add').addEventListener('click', ()=>{
        const name = $('#qa-name').value.trim(); const price = Number($('#qa-price').value || 0);
        if(!name || !price){ toast('Provide name & price'); return; }
        const menu = load(KEY_MENU, DEFAULT_MENU);
        menu.push({ id: uid('m'), name, price, desc:'Added quickly', category:'Quick' });
        save(KEY_MENU, menu); $('#qa-name').value=''; $('#qa-price').value=''; renderMenu(); toast('Quick item added');
      });

      // remove via long-press/context
      menuGrid.addEventListener('contextmenu', (ev)=>{
        ev.preventDefault();
        const card = ev.target.closest('.menu-card');
        if(!card) return;
        if(confirm('Remove this menu item?')) removeItem(card.dataset.id);
      });

      // small fade-in sections on scroll
      const sections = $$('.section');
      const io = new IntersectionObserver(entries=>{
        entries.forEach(en=>{
          if(en.isIntersecting) en.target.classList.add('visible');
        });
      }, {threshold:0.08});
      sections.forEach(s=> io.observe(s));

      // initial toast
      toast('BrewHaven v2 — luxury demo ready!');
    }

    // run init on DOMContentLoaded
    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();

    // ---------- small helpers for global use ----------
    function openEdit(id){ openEditItem(id); } // placeholder if needed

    // for saving menu via external calls (used internally)
    function save(key, v){ localStorage.setItem(key, JSON.stringify(v)); }
    function load(key, fallback=null){ try{ const r = localStorage.getItem(key); return r?JSON.parse(r):fallback; }catch(e){ return fallback; } }

    // alias to remove item when asked from outside
    function openEditItem(id){
      const menu = load(KEY_MENU, DEFAULT_MENU);
      const it = menu.find(m=>m.id===id);
      if(!it){ toast('Item not found'); return; }
      $('#i-name').value = it.name; $('#i-price').value = it.price; $('#i-desc').value = it.desc || ''; $('#i-cat').value = it.category || ''; $('#i-img').value = it.img || '';
      $('#item-form').dataset.editId = id;
      document.querySelector('#admin').scrollIntoView({behavior:'smooth'});
      toast('Loaded item into form for editing');
    }

  </script>
</body>
</html>
